class String
  def self.colorize(text, color_code)
    "\e[#{color_code}m#{text}\e[0m"
  end

  def red
    self.class.colorize(self, 31)
  end

  def green
    self.class.colorize(self, 32)
  end
end

namespace :test do
  task :prepare do
    unless `which pod`.length > 0
      puts "Please install CocoaPods to continue".red
    else
      sh("cd Tests && pod install")
    end
  end
end

desc "Run all PBKDF2-Wrapper Tests"
task :test do
  sh("xcodebuild -workspace PBKDF2-Wrapper.xcworkspace -scheme 'PBKDF2-Wrapper Tests' -sdk 'iphonesimulator' -configuration Release clean test | xcpretty -c ; exit ${PIPESTATUS[0]}") rescue nil
  if $?.success?
    puts "PBKDF2-Wrapper Tests passed".green
  else
    puts "PBKDF2-Wrapper Tests failed".red
    exit $?.exitstatus
  end
end

task :default => 'test'
